<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduConnectGPT - Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --primary-color: #0d1472;
            --secondary-color: #f0f4ff;
            --accent-color: #3c4fe0;
            --text-color: #333;
            --light-text: #888;
            --white: #fff;
            --purple-gradient: linear-gradient(135deg, #1a0049 0%, #3c4fe0 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--white);
            color: var(--text-color);
            position: relative; /* For floating buttons positioning */
        }

        header {
            background-color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 40px;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin: 0 1rem;
        }

        nav ul li a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            padding: 0.5rem 0;
        }

        nav ul li a.active {
            color: var(--accent-color);
            font-weight: 600;
        }

        .nav-dropdown::after {
            content: "▼";
            font-size: 0.7em;
            margin-left: 5px;
            color: var(--light-text);
        }

        .right-actions {
            display: flex;
            align-items: center;
        }

        .right-actions > * {
            margin-left: 1rem;
        }

        .search-icon, .credit-icon, .notification-icon, .account-icon {
            font-size: 1.2rem;
            color: var(--text-color);
            cursor: pointer;
        }

        .credit-icon {
            background-color: #f5f5f5;
            padding: 0.3rem 0.7rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        /* Account Dropdown Styles */
        .account-container {
            position: relative;
            cursor: pointer;
        }

        .account-icon {
            position: relative;
            z-index: 1001; /* Make sure this is above the dropdown */
        }

        .account-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--white);
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: 8px;
            padding: 0.5rem 0;
            margin-top: 0.5rem;
            z-index: 1000;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        /* Add this to create an invisible bridge between icon and dropdown */
        .account-dropdown::before {
            content: '';
            position: absolute;
            top: -10px; /* Adjust based on your margin-top value */
            left: 0;
            width: 100%;
            height: 10px;
            background-color: transparent;
        }

        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(-10px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .account-container:hover .account-dropdown {
            display: block;
        }

        .dropdown-item {
            padding: 0.8rem 1.5rem;
            display: block;
            color: var(--text-color);
            text-decoration: none;
            transition: background-color 0.2s ease;
            font-size: 0.95rem;
        }

        .dropdown-item:hover {
            background-color: var(--secondary-color);
            color: var(--accent-color);
        }

        .dropdown-divider {
            height: 1px;
            background-color: #eee;
            margin: 0.3rem 0;
        }

        /* Search Bar Styles */
        .animated-underline {
        position: relative;
        text-decoration: none;
        }

        .animated-underline::after {
        content: '';
        position: absolute;
        width: 0;
        height: 2px;
        bottom: 0;
        left: 0;
        background-color: #1e40af; /* Blue color for the underline */
        transition: width 0.3s ease-in-out;
        }

        .animated-underline:hover::after {
        width: 100%;
        }
        .search-container {
            position: relative;
            margin-top: 1rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .search-bar {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 3rem;
            border: 1px solid #ddd;
            border-radius: 50px;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 2px 10px rgba(60, 79, 224, 0.15);
        }

        .search-icon-input {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--light-text);
            font-size: 1.2rem;
        }

        .search-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--accent-color);
            color: var(--white);
            border: none;
            padding: 0.5rem 1.2rem;
            border-radius: 50px;
            font-weight: 500;
            cursor: pointer;
        }

        .hero-section {
            background: var(--purple-gradient);
            color: var(--white);
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .hero-content h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .hero-content p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            line-height: 1.6;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .learn-more-btn {
            background-color: #ffdd00;
            color: var(--text-color);
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
        }

        .learn-more-btn::after {
            content: "→";
            margin-left: 0.5rem;
        }

        .features-section {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 3rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
        }

        .feature-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .feature-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .feature-description {
            color: var(--light-text);
            line-height: 1.6;
        }

        .message-list-section {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .message-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }

        .message-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            min-height: 200px;
            justify-content: space-between;
            position: relative;
        }

        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 1rem;
            background-color: #ddd; /* Fallback color */
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block; /* Helps remove potential bottom space */
        }

        .user-info h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .message-time {
            color: var(--light-text);
            font-size: 0.9rem;
        }

        .message-content {
            line-height: 1.6;
            margin-bottom: 1rem;
            flex-grow: 1;
            min-height: 50px;
        }

        .message-actions .spacer {
            flex-grow: 1;
        }

        .message-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
            flex-wrap: nowrap;
            align-items: center;
        }

        .message-btn {
            background-color: var(--accent-color);
            color: var(--white);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .message-btn:hover {
             background-color: #2a3bb0; /* Slightly darker on hover */
        }

        footer {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 3rem 2rem;
            margin-top: 4rem;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: 2rem; /* Add gap between footer sections */
        }

        .footer-left {
            max-width: 300px;
            flex-basis: 300px; /* Give it a base width */
            flex-grow: 1; /* Allow it to grow if needed */
        }

        .footer-logo {
            margin-bottom: 1rem;
            display: block;
        }

        .footer-logo img {
            height: 60px;
        }

        .mission-statement {
            margin-bottom: 1rem;
            font-weight: 500;
            line-height: 1.5;
        }

        .team-credit {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        .footer-links {
            text-align: left; /* Align left for consistency */
            flex-basis: 200px; /* Give it a base width */
            flex-grow: 1;
        }

        .footer-links ul {
            list-style: none;
            padding: 0; /* Remove default padding */
        }

        .footer-links li {
            margin: 0.5rem 0;
        }

        .footer-links a {
            color: var(--white);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: rgba(255,255,255,0.7);
        }

        .footer-socials {
            text-align: left; /* Align left */
            flex-basis: 200px; /* Give it a base width */
            flex-grow: 1;
        }

        .footer-socials h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: var(--white);
        }

        .social-icons-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .social-icon-item {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 0;
            transition: transform 0.2s ease;
        }

        .social-icon-item:hover {
            transform: scale(1.1);
        }

        .social-icon-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }


        /* Floating Action Buttons */
        .floating-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 999;
        }

        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .floating-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .post-btn {
            background-color: var(--accent-color);
            color: var(--white);
            font-size: 24px;
        }

        .chat-btn {
            background-color: #25D366; /* WhatsApp Green */
            color: var(--white);
        }

        .chat-btn img {
            width: 30px;
            height: 30px;
            object-fit: contain;
        }

        /* Chat interface styles */
        .chat-container {
            position: fixed;
            bottom: 100px; /* Adjusted to be above floating buttons */
            right: 30px;
            width: 350px;
            height: 450px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1001;
            display: none; /* Initially hidden */
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {transform: translateY(20px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }

        .chat-header {
            padding: 15px;
            background-color: var(--accent-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .close-chat {
            font-size: 1.5rem;
            cursor: pointer;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f5f5f5;
        }

        .message {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 18px;
            flex-shrink: 0; /* Prevent avatar shrinking */
        }

        .bot-message .message-avatar {
            background-color: var(--accent-color);
            color: white;
        }

        .user-message {
            flex-direction: row-reverse;
        }

        .user-message .message-avatar {
            margin-right: 0;
            margin-left: 10px;
            background-color: #25D366;
            color: white;
        }

        .message-content {
            background-color: white;
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%; /* Adjust max-width slightly */
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            word-wrap: break-word; /* Break long words */
        }

        .user-message .message-content {
            background-color: var(--accent-color);
            color: white;
        }

        .message-content p {
            margin: 0;
            line-height: 1.4; /* Improve readability */
        }

        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #ddd;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            margin-right: 10px; /* Space before button */
        }

        .chat-input button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
         .chat-input button:hover {
             background-color: #2a3bb0;
         }


        /* Modal styles for post function */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            position: relative;
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal-content.active {
            transform: scale(1);
            opacity: 1;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: var(--light-text);
        }

        .modal-title {
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            color: var(--accent-color);
            text-align: center; /* Center title */
        }

        .post-form textarea {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 1rem;
            resize: vertical;
            line-height: 1.5;
        }
         .post-form textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(60, 79, 224, 0.2);
        }

        .modal-action-btn {
            display: inline-block; /* Important for <a> tag */
            text-decoration: none; /* Remove underline from <a> */
            background-color: var(--accent-color);
            color: var(--white) !important; /* Use !important if specificity issues arise */
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-align: center; /* Ensure text is centered */
            margin-right: 10px; /* Add space between buttons */
            vertical-align: middle; /* Align items vertically if needed */
        }
        .modal-action-btn:last-child {
             margin-right: 0; /* Remove margin from the last button */
        }

        /* Apply hover to the common class */
        .modal-action-btn:hover {
            background-color: #2a3bb0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            color: var(--white); /* Ensure hover color stays white for <a> */
        }

        .modal-action-btn.posting {
            background-color: #6c757d;
            pointer-events: none;
            cursor: not-allowed;
        }

        /* Animation for button click */
        .submit-btn-animation::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background-color: rgba(255,255,255,0.3);
            transition: width 0.3s ease;
        }
        .submit-btn-animation:active::after {
            width: 100%;
            transition: width 0.1s ease;
        }

        @keyframes modalFade { /* Keep if needed elsewhere, not currently used by modal */
            from {opacity: 0; transform: translateY(-20px);}
            to {opacity: 1; transform: translateY(0);}
        }


        @media (max-width: 1024px) {
            .features-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .message-list {
                grid-template-columns: 1fr; /* Stack messages on smaller screens */
            }
            header {
                padding: 1rem; /* Reduce header padding */
            }
            nav ul {
                display: none; /* Consider a mobile menu toggle */
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column; /* Stack logo/nav/actions */
                align-items: flex-start;
                padding: 1rem;
            }
            .right-actions {
                 margin-top: 0.5rem; /* Add space if header stacks */
                 margin-left: 0; /* Reset margin */
                 width: 100%;
                 justify-content: flex-end; /* Align icons right */
            }
            .hero-section {
                padding: 3rem 1rem; /* Adjust padding */
                 /* padding-bottom: 300px; -- Removed this, seems excessive */
            }
            .hero-content h1 {
                 font-size: 2rem; /* Adjust font size */
            }
             .hero-content p {
                 font-size: 1rem; /* Adjust font size */
            }

            .features-grid {
                grid-template-columns: 1fr; /* Single column */
            }

            .footer-content {
                flex-direction: column;
                gap: 2rem;
                text-align: center; /* Center align footer content */
            }

            .footer-left, .footer-links, .footer-socials {
                max-width: none; /* Remove max width */
                flex-basis: auto; /* Reset basis */
                text-align: center; /* Ensure centered */
            }
             .social-icons-list {
                 justify-content: center; /* Center social icons */
             }

            .search-container {
                margin: 1rem; /* Adjust margin */
                max-width: none; /* Full width */
            }

            .search-btn {
                padding: 0.5rem 0.8rem;
                font-size: 0.9rem;
            }

            .floating-buttons {
                bottom: 20px;
                right: 20px;
            }

            .floating-btn {
                width: 50px;
                height: 50px;
            }

            /* Ensure dropdown is properly positioned on mobile */
            .account-dropdown {
                right: 0; /* Align to the right edge of container */
                left: auto;
            }
             .chat-container {
                width: 90%; /* Make chat wider on mobile */
                height: 70%; /* Adjust height */
                bottom: 80px; /* Adjust position */
                right: 5%;
            }
        }

        /* New Post Animation */
        @keyframes newPostAppear {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-card.new-post {
            animation: newPostAppear 0.8s ease forwards;
            border-left: 3px solid var(--accent-color);
        }

        /* Animation for form open */
        .post-form.animate { /* Add this class when opening modal if desired */
            animation: formExpand 0.5s ease forwards;
        }

        @keyframes formExpand {
            from { transform: scale(0.95); opacity: 0.8; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Success Message Animation */
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .post-success {
            color: #28a745;
            text-align: center;
            margin-top: 10px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
            height: 0; /* Hide initially */
            overflow: hidden; /* Hide initially */
        }

        .post-success.show {
            opacity: 1;
            height: auto; /* Show */
            animation: successPulse 0.5s ease;
        }

        /* Pagination Styles */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem 0;
            gap: 0.5rem;
        }

        .page-item {
            background-color: #f0f4ff;
            border: 1px solid transparent;
            border-radius: 6px;
            color: var(--text-color);
            padding: 0.5rem 1rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
            min-width: 40px;
            text-align: center;
        }

        .page-item:hover {
            background-color: #e2e8f5;
        }

        .page-item.active {
            background-color: var(--accent-color);
            color: var(--white);
            border-color: var(--accent-color);
            cursor: default;
        }

        .page-item:disabled {
            background-color: #f8f9fa;
            color: #adb5bd;
            cursor: not-allowed;
        }

        /* Like Button Styles */
        .like-btn {
            background-color: #e2e8f0;
            color: #4a5568;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .like-btn i {
            transition: transform 0.2s ease;
        }

        .like-btn.liked {
            background-color: var(--accent-color);
            color: var(--white);
        }
        .like-btn.liked i {
            transform: scale(1.1) rotate(-10deg);
        }

        /* Comment Section Styles */
        .comment-trigger-btn {
            background-color: #e2e8f0;
            color: #4a5568;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .comment-section {
            display: none; /* Hidden by default */
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        .comment-section.active {
            display: block;
        }

        .comments-display-area {
            margin-bottom: 0.8rem;
            max-height: 150px;
            overflow-y: auto;
            padding-right: 5px; /* Add some space for scrollbar */
        }

        .comment-item {
            background-color: #f7fafc;
            padding: 0.5rem 0.8rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            border: 1px solid #e2e8f0;
            word-wrap: break-word; /* Wrap long comments */
        }
        .comment-item strong {
            color: var(--primary-color);
            margin-right: 0.5rem;
        }

        .comment-input-area {
            display: flex;
            gap: 0.5rem;
            align-items: flex-start; /* Align button top */
        }

        .comment-input {
            flex-grow: 1;
            min-height: 40px;
            padding: 0.5rem 0.8rem;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 0.9rem;
            resize: vertical;
            line-height: 1.4;
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(60, 79, 224, 0.2);
        }

        .post-comment-btn {
            flex-shrink: 0;
            padding: 0.5rem 1rem;
            height: 40px; /* Match input height */
        }

        /* Tutor Dropdown Styles */
        .icon-btn {
            background: none;
            border: none;
            padding: 0.3rem 0.5rem;
            cursor: pointer;
            color: var(--light-text);
            font-size: 1.1rem;
            line-height: 1;
            transition: color 0.2s ease;
        }
        .icon-btn:hover {
            color: var(--accent-color);
        }

        .message-header .tutor-menu-trigger {
            margin-left: auto; /* Push trigger to the right */
        }

        .tutor-list-dropdown {
            display: none; /* Hidden by default */
            position: absolute;
            top: 40px; /* Position below header */
            right: 1rem; /* Align to right within card */
            background-color: var(--white);
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            padding: 0;
            min-width: 250px;
            max-width: 320px;
            z-index: 10;
            border: 1px solid #eee;
            overflow: hidden; /* Clip content */
        }

        .tutor-list-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        .tutor-list-dropdown ul {
            list-style: none;
            margin: 0;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .tutor-list-dropdown li {
            border-bottom: 1px solid #f0f4ff;
        }
        .tutor-list-dropdown li:last-child {
            border-bottom: none;
        }
        .tutor-list-dropdown li:hover .tutor-item-container {
            background-color: var(--secondary-color);
        }

        .tutor-item-container {
            padding: 0.8rem 1rem;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: flex-start; /* Align items top */
            gap: 0.8rem;
        }

        .tutor-avatar-dropdown {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            background-color: #eee; /* Fallback */
        }

        .tutor-avatar-dropdown img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .tutor-details-actions-wrapper {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            overflow: hidden; /* Prevent content overflow */
        }

        .tutor-info-dropdown .tutor-name {
            display: block;
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.2rem;
            white-space: nowrap; /* Prevent wrapping */
            overflow: hidden;
            text-overflow: ellipsis; /* Add ... if name is too long */
        }
        .tutor-info-dropdown .tutor-name:hover {
            text-decoration: underline;
        }

        .tutor-description {
            font-size: 0.85rem;
            color: var(--light-text);
            margin: 0 0 0.8rem 0;
            line-height: 1.4;
            /* Limit description lines if needed */
            /* display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden; */
        }

        .tutor-item-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tutor-item-actions .message-btn {
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
        }

    </style>
</head>
<body>
    <header>
        <div class="logo">
            <!-- Make sure the path to your logo is correct -->
            <img src="images/Educonnect_logo.png" alt="EduConnectGPT Logo">
        </div>
        <nav>
            <ul>
                <li><a href="#" class="active">Home</a></li>
                <li><a href="/review" class="nav-item px-2 py-1 text-gray-700 hover:text-blue-900 animated-underline">Tutors</a></li>
                <li><a href="/ranking" class="nav-item px-2 py-1 text-gray-700 hover:text-blue-900 animated-underline">Ranking</a></li>
                <li><a href="/support" class="nav-item px-2 py-1 text-gray-700 hover:text-blue-900 animated-underline">Support</a></li>
                <li><a href="/educonnectGPT" class="nav-item px-2 py-1 text-gray-700 hover:text-blue-900 animated-underline">EduconnectGPT</a></li>
                <li><a href="/chat" class="nav-item px-2 py-1 text-gray-700 hover:text-blue-900 animated-underline">Chat</a></li>
                <li><a href="/schedule" class="nav-item px-2 py-1 text-gray-700 hover:text-blue-900 animated-underline">Schedule</a></li>
            </ul>
        </nav>
        <div class="right-actions">
            <div class="credit-icon">0.0 $</div>
            <a href="notification.html" class="notification-icon" style="text-decoration: none;">🔔</a>
            <!-- Updated account icon with dropdown -->
            <div class="account-container">
                <div class="account-icon">👤</div>
                <div class="account-dropdown">
                    <a href="profile.html" class="dropdown-item">Profile</a>
                    <a href="setting.html" class="dropdown-item">Setting</a>
                    <a href="pricing.html" class="dropdown-item">Pricing</a>
                    <div class="dropdown-divider"></div>
                    <a href="login.html" class="dropdown-item">Sign out</a>
                </div>
            </div>
        </div>
    </header>

    <section class="hero-section">
        <div class="hero-content">
            <h1>We are EduConnect</h1>
            <h1>Connecting knowledge, stepping firmly into the future</h1>
            <p>Join our growing community of learners and educators to expand your horizons.</p>
            <button class="learn-more-btn">Learn More</button>
        </div>
    </section>

    <!-- Search Bar -->
    <div class="search-container">
        <span class="search-icon-input">🔍</span>
        <input type="text" class="search-bar" placeholder="Search for tutors, courses, or topics...">
        <button class="search-btn">Search</button>
    </div>

    <section class="features-section">
        <h2 class="section-title">How EduConnect Works</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">📚</div>
                <h3 class="feature-title">Connect with Tutors</h3>
                <p class="feature-description">Find experienced tutors in various subjects who can help you master any topic.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">💬</div>
                <h3 class="feature-title">AI-Powered Learning</h3>
                <p class="feature-description">Get instant help with our EduconnectGPT assistant for quick answers and guidance.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🌟</div>
                <h3 class="feature-title">Track Your Progress</h3>
                <p class="feature-description">Monitor your learning journey with detailed analytics and personalized insights.</p>
            </div>
        </div>
    </section>

    <section class="message-list-section">
        <div class="message-list" id="messageListContainer">
            <!-- Message cards will be loaded here by JavaScript -->
        </div>
    </section>

    <div class="pagination-container" id="paginationControls">
        <!-- Page numbers will be generated here by JavaScript -->
    </div>

    <!-- Floating Action Buttons -->
    <div class="floating-buttons">
        <div class="floating-btn chat-btn" id="chatBtn">
             <!-- Make sure the path to your chat icon is correct -->
            <img src="images/chatbot.png" alt="Chat">
        </div>
        <div class="floating-btn post-btn" id="postBtn">
            <span>+</span>
        </div>
    </div>

    <!-- Chat Interface -->
    <div id="chatInterface" class="chat-container">
        <div class="chat-header">
          <h3>EduConnect Chat</h3>
          <span class="close-chat" id="closeChat">×</span>
        </div>
        <div class="chat-messages" id="chatMessages">
          <div class="message bot-message">
            <div class="message-avatar">🤖</div>
            <div class="message-content">
              <p>Hello! How can I help you with your learning needs today?</p>
            </div>
          </div>
          <!-- More messages can be added here -->
        </div>
        <div class="chat-input">
          <input type="text" id="messageInput" placeholder="Type your message...">
          <button id="sendMessage">Send</button>
        </div>
      </div>


    <!-- Post Modal -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">×</span>
            <h2 class="modal-title">Create a New Post</h2>
            <form class="post-form" id="newPostForm">
                <textarea id="postContent" placeholder="What do you need help with? Describe your learning needs..." required></textarea>
                <div style="text-align: right;"> <!-- Align buttons right -->
                    <button type="button" id="submitPost" class="modal-action-btn submit-btn-animation">Post</button>
                    <a href="match.html" id="matchButton" class="modal-action-btn submit-btn-animation">Match</a>
                </div>
                <p class="post-success" id="postSuccess">Post created successfully!</p>
            </form>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-left">
                <div class="footer-logo">
                     <!-- Make sure the path to your logo is correct -->
                    <img src="images/Educonnect_logo.png" alt="EduConnectGPT Logo">
                </div>
                <p class="mission-statement">EduConnect - Connecting knowledge, stepping firmly into the future.</p>
                <p class="team-credit">— EduConnect team</p>
            </div>

            <div class="footer-links">
                 <h3>Quick Links</h3> <!-- Added heading -->
                <ul>
                    <li><a href="#">All pages</a></li>
                    <li><a href="#">All Courses</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Refund and Returns Policy</a></li>
                    <li><a href="#">About us</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Terms and Conditions</a></li>
                </ul>
            </div>

            <div class="footer-socials">
                <h3>Follow Us</h3>
                <div class="social-icons-list">
                    <!-- Replace YOUR_LINK placeholders with actual links -->
                    <!-- Make sure paths to social icons are correct -->
                    <a href="YOUR_YOUTUBE_LINK" target="_blank" class="social-icon-item" title="YouTube">
                        <img src="images/Youtube.jpg" alt="YouTube">
                    </a>
                    <a href="YOUR_FACEBOOK_LINK" target="_blank" class="social-icon-item" title="Facebook">
                        <img src="images/facebook.jpg" alt="Facebook">
                    </a>
                    <a href="YOUR_LINKEDIN_LINK" target="_blank" class="social-icon-item" title="LinkedIn">
                        <img src="images/linkedln.jpg" alt="LinkedIn">
                    </a>
                    <a href="YOUR_TIKTOK_LINK" target="_blank" class="social-icon-item" title="TikTok">
                        <img src="images/tiktok.jpg" alt="TikTok">
                    </a>
                    <a href="YOUR_INSTAGRAM_LINK" target="_blank" class="social-icon-item" title="Instagram">
                        <img src="images/insta.jpg" alt="Instagram">
                    </a>
                    <a href="YOUR_DISCORD_LINK" target="_blank" class="social-icon-item" title="Discord">
                        <img src="images/discord.jpg" alt="Discord">
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DOM Elements ---
            const searchBar = document.querySelector('.search-bar');
            const searchBtn = document.querySelector('.search-btn');
            const postBtn = document.getElementById('postBtn');
            const postModal = document.getElementById('postModal');
            const modalContent = postModal.querySelector('.modal-content'); // More specific selector
            const closeModalBtn = document.getElementById('closeModal');
            const chatBtn = document.getElementById('chatBtn');
            const chatInterface = document.getElementById('chatInterface');
            const closeChatBtn = document.getElementById('closeChat');
            const messageInputChat = document.getElementById('messageInput');
            const sendMessageChat = document.getElementById('sendMessage');
            const chatMessages = document.getElementById('chatMessages');
            const newPostForm = document.getElementById('newPostForm');
            const postContentInput = document.getElementById('postContent');
            const submitPostBtn = document.getElementById('submitPost');
            const messageListContainer = document.getElementById('messageListContainer'); // Use the ID added to HTML
            const paginationControls = document.getElementById('paginationControls');
            const postSuccessMsg = document.getElementById('postSuccess');
            const matchButton = document.getElementById('matchButton'); // Get the Match button
    
            // --- State Variables ---
            let allPostsData = [];
            let currentPage = 1;
            const postsPerPage = 4; // Number of posts per page
    
            // --- Default Data ---
            const placeholderAvatar = 'avatar-placeholder.png';
            const defaultPosts = [
                 { id: 1, user: "Nguyen Thu Trang", avatar: "avatar1.png", time: "2 hours ago", content: "Cần tìm gia sư Toán lớp 10 khu vực Hà Nội. Mình cần tìm gia sư dạy Toán lớp 10, chủ yếu ôn Đại số, Hình học. Lương sẽ thỏa thuận tùy vào khả năng, ít theo kíp mỗi bài khó. Cần 1 anh/chị dạy dễ hiểu, hướng dẫn tận tình, giúp làm bài tập với ôn chuẩn bị cuối kì." },
                 { id: 2, user: "Mai Anh", avatar: "avatar2.png", time: "1 hour ago", content: "Hello mọi người, mình là Mai Anh, học lớp 11 mà Toán hơi lẹt đẹt nên muốn tìm một anh/chị gia sư cuối dạy mình phần Hàm số, Đạo hàm, Hình học không gian. Trên lớp nghe giảng mà đầu cứ quay quay, làm bài tập toán tuần này 😓." },
                 { id: 3, user: "Nguyen Trong Minh", avatar: "avatar3.png", time: "2 hours ago", content: "Hello mọi người, mình là Minh, học lớp 12 mà Toán đang hơi đuối, nhất là Hàm số, Tích phân, Hình không gian. Đi học trên lớp thì ngồi nghe mà đầu óc cứ như trên mây, về nhà làm đề toán sai 😓." },
                 { id: 4, user: "Đặng Quang", avatar: "avatar4.png", time: "1 hour ago", content: "Tìm gia sư Toán cứu với cuộc đời em 😓 Chào mọi người, em là Quang, học lớp 11 mà Toán cứ như một vòng luẩn quẩn → hoang mang → làm sai 😓." },
                 { id: 5, user: "Le Binh", avatar: "images/Lê Nguyễn Thanh Bình.jpg", time: "3 hours ago", content: "Cần tìm gia sư Toán lớp 10 gấp ạ 😭 Em là Lê Nguyễn Thanh Bình, mới lên lớp 10 mà Hình học với Đại số em mất gốc từ cấp 2 rồi, giờ nghe giảng không hiểu gì cả, bài tập thì nhìn như bức vách. Cần anh chị nào kiên nhẫn dạy lại giúp em với, em cảm ơn nhiều ạ." },
                 { id: 6, user: "Ngoc Hieu", avatar: "images/Ngoc Hieu.png", time: "4 hours ago", content: "Tìm gia sư Toán 12 ôn thi ĐH gấp!!! 😥 Mình là Hiếu, sắp thi rồi mà Toán còn yếu quá, nhất là mấy dạng vận dụng cao giải mãi không ra, thấy đề là hoang mang. Có anh chị nào kinh nghiệm ôn thi, hệ thống kiến thức tốt giúp mình với. Lo quá!" },
                 { id: 7, user: "Trinh Chau", avatar: "images/Trinh Chau.png", time: "5 hours ago", content: "Ai cứu em môn Hình không gian với ạ 🙏 Em là Châu lớp 11. Cứ học đến hình không gian là đầu óc em quay cuồng, trừu tượng quá không tưởng tượng nổi hình luôn, vẽ sai hoài 😵. Cần một gia sư dạy dễ hiểu phần này gấp ạ, SOS!" },
                 { id: 8, user: "Duc Manh", avatar: "images/Duc Manh.png", time: "6 hours ago", content: "Có ai nhận dạy kèm Toán cho học sinh yếu không ạ? 🥺 Em là Mạnh, lớp 10. Em sợ môn Toán lắm, làm bài toàn sai, điểm lúc nào cũng thấp lè tè. Muốn tìm gia sư tận tình, kiên nhẫn, nói dễ hiểu giúp em lấy lại căn bản với ạ, chứ tình hình này chắc em tiêu." },
            ];
            const suggestedTutors = [
                { name: "Gia sư Nguyễn Văn A", description: "Sinh viên năm 3 ĐH Bách Khoa, chuyên Toán Lý Hóa, kinh nghiệm 2 năm.", avatar: "images/Lê Nguyễn Thanh Bình.jpg" },
                { name: "Gia sư Trần Thị B", description: "Giáo viên về hưu, >10 năm kinh nghiệm dạy Toán cấp 2, 3.", avatar: "images/ảnh tutor 2.jpg" },
                { name: "Gia sư Lê Văn C", description: "Thủ khoa đầu vào Sư Phạm Toán, nhiệt tình, phương pháp dễ hiểu.", avatar: "images/ảnh tutor 3.jpg" },
                { name: "Gia sư Phạm Thị D", description: "Du học sinh Mỹ, điểm SAT Toán 800/800.", avatar: "images/ảnh tutor 4.jpg" },
            ];
    
            // --- Functions ---
    
            function renderPostCard(postData) {
                const card = document.createElement('div');
                card.className = 'message-card';
                card.dataset.postId = postData.id || Date.now(); // Use provided ID or generate one
    
                const userName = postData.user || "User";
                const userAvatar = postData.avatar || placeholderAvatar;
                const postTime = postData.time || "Recently";
                const postText = (postData.content || "No content")
                                    .replace(/</g, "<") // More robust sanitization
                                    .replace(/>/g, ">")
                                    .replace(/\n/g, '<br>');
    
    
                card.innerHTML = `
                    <div class="message-header">
                        <div class="user-avatar">
                           <img src="${userAvatar}" alt="${userName}" onerror="this.onerror=null;this.src='${placeholderAvatar}';">
                        </div>
                        <div class="user-info"><h3>${userName}</h3><p class="message-time">${postTime}</p></div>
                        <button class="message-btn icon-btn tutor-menu-trigger" title="Show Suggested Tutors">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                    <div class="message-content"><p>${postText}</p></div>
                    <div class="message-actions">
                        <button class="message-btn like-btn"><i class="far fa-thumbs-up"></i> Like</button>
                        <button class="message-btn comment-trigger-btn"><i class="far fa-comment"></i> Comment</button>
                        <div class="spacer"></div>
                        <a href="chat.html?user=${encodeURIComponent(userName)}&avatar=${encodeURIComponent(userAvatar)}" class="message-btn" style="text-decoration: none;">Send message</a>
                        <button class="message-btn">Send Request</button>
                    </div>
                    <div class="comment-section">
                        <div class="comments-display-area"></div>
                        <div class="comment-input-area">
                            <textarea class="comment-input" placeholder="Write a comment..." rows="1"></textarea>
                            <button class="message-btn post-comment-btn">Post</button>
                        </div>
                    </div>
                    <div class="tutor-list-dropdown">
                        <ul>
                            ${suggestedTutors.map(tutor => `
                                <li>
                                    <div class="tutor-item-container">
                                        <div class="tutor-avatar-dropdown">
                                            <img src="${tutor.avatar || placeholderAvatar}" alt="${tutor.name}" onerror="this.onerror=null;this.src='${placeholderAvatar}';">
                                        </div>
                                        <div class="tutor-details-actions-wrapper">
                                            <div class="tutor-info-dropdown">
                                                <a href="#" class="tutor-name" title="${tutor.name}">${tutor.name}</a>
                                                <p class="tutor-description">${tutor.description}</p>
                                            </div>
                                            <div class="tutor-item-actions">
                                                <a href="chat.html?user=${encodeURIComponent(tutor.name)}&avatar=${encodeURIComponent(tutor.avatar || placeholderAvatar)}" class="message-btn tutor-msg-btn" style="text-decoration: none;">Message</a>
                                                <button class="message-btn tutor-req-btn">Request</button>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    </div>`;
                const commentInput = card.querySelector('.comment-input');
                if (commentInput) {
                    commentInput.addEventListener('input', autoResizeTextarea);
                }
                return card;
            }
    
            function autoResizeTextarea(event) {
                const textarea = event.target;
                textarea.style.height = 'auto';
                textarea.style.height = textarea.scrollHeight + 'px';
            }
    
            function displayPage(page) {
                currentPage = page;
                messageListContainer.innerHTML = '';
                const startIndex = (page - 1) * postsPerPage;
                const endIndex = startIndex + postsPerPage;
                const postsToShow = allPostsData.slice(startIndex, endIndex);
                postsToShow.forEach(postData => {
                    const cardElement = renderPostCard(postData);
                    messageListContainer.appendChild(cardElement);
                });
                renderPaginationControls();
            }
    
            function renderPaginationControls() {
                if (!paginationControls) return;
                paginationControls.innerHTML = '';
                const totalPages = Math.ceil(allPostsData.length / postsPerPage);
                if (totalPages <= 1) return;
    
                const prevButton = document.createElement('button');
                prevButton.className = 'page-item';
                prevButton.textContent = '«';
                prevButton.disabled = currentPage === 1;
                prevButton.onclick = () => { if (currentPage > 1) { displayPage(currentPage - 1); scrollToTop(); } };
                paginationControls.appendChild(prevButton);
    
                for (let i = 1; i <= totalPages; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.className = `page-item ${i === currentPage ? 'active' : ''}`;
                    pageButton.textContent = i;
                    pageButton.onclick = () => { displayPage(i); scrollToTop(); };
                    paginationControls.appendChild(pageButton);
                }
    
                const nextButton = document.createElement('button');
                nextButton.className = 'page-item';
                nextButton.textContent = '»';
                nextButton.disabled = currentPage === totalPages;
                nextButton.onclick = () => { if (currentPage < totalPages) { displayPage(currentPage + 1); scrollToTop(); } };
                paginationControls.appendChild(nextButton);
            }
    
            function scrollToTop() {
                messageListContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
    
            function initializePosts() {
                allPostsData = [...defaultPosts].reverse();
            }
    
            function handlePostSubmit() {
                const content = postContentInput.value.trim();
                if (!content) {
                    alert("Please write something in your post.");
                    return;
                }
    
                submitPostBtn.classList.add('posting');
                submitPostBtn.textContent = 'Posting...';
                submitPostBtn.disabled = true;
                if(matchButton) {
                     matchButton.classList.add('posting'); // Also visually disable match button
                     matchButton.style.pointerEvents = 'none'; // Prevent clicking match while posting
                }
    
    
                setTimeout(() => {
                    const newPostData = {
                        user: "Lê Nguyễn Thanh Bình",
                        avatar: "images/Lê Nguyễn Thanh Bình.jpg",
                        time: "Just now",
                        content: content,
                        id: Date.now()
                    };
                    allPostsData.unshift(newPostData);
                    displayPage(1);
    
                    const firstCard = messageListContainer.querySelector('.message-card:first-child');
                    if (firstCard) {
                        firstCard.classList.add('new-post');
                        setTimeout(() => firstCard.classList.remove('new-post'), 1500);
                    }
                    postSuccessMsg.classList.add('show');
    
                    setTimeout(() => {
                        modalContent.classList.remove('active');
                        setTimeout(() => {
                            postModal.style.display = 'none';
                            postContentInput.value = '';
                            postSuccessMsg.classList.remove('show');
                            submitPostBtn.classList.remove('posting');
                            submitPostBtn.textContent = 'Post';
                            submitPostBtn.disabled = false;
                             if(matchButton) {
                                matchButton.classList.remove('posting'); // Re-enable match button
                                matchButton.style.pointerEvents = 'auto';
                             }
                        }, 300);
                    }, 1200);
    
                }, 800);
            }
    
            // --- NEW: Function to handle Match button click ---
            function handleMatchClick(event) {
                event.preventDefault(); // Prevent default <a> tag navigation
    
                const postText = postContentInput.value.trim();
    
                // Optional: Add validation if needed (e.g., require post text)
                if (!postText) {
                    alert("Please write something in your post before matching.");
                    return; // Stop if no content
                }
    
                // Add visual feedback
                matchButton.classList.add('posting'); // Reuse 'posting' style
                matchButton.textContent = 'Matching...';
                matchButton.style.pointerEvents = 'none'; // Prevent double clicks
                submitPostBtn.disabled = true; // Disable post button too
    
    
                // --- Trigger the FastAPI endpoint ---
                const recommenderUrl = 'http://127.0.0.1:8000/recommender/';
                console.log(`Calling Recommender API at: ${recommenderUrl} with content.`);
    
                // Use fetch to send a POST request (adjust method if needed)
                fetch(recommenderUrl, {
                    method: 'POST', // Or 'GET', 'PUT' depending on your API design
                    headers: {
                        'Content-Type': 'application/json', // Assuming your API expects JSON
                        // Add any other headers like Authorization if required
                    },
                    body: JSON.stringify({ student_request: postText }) // Send the post content
                })
                .then(response => {
                    // We don't wait for the response body, but check if the request initiation was okay
                    console.log(`Recommender API call initiated. Status: ${response.status}`);
                    if (!response.ok) {
                        console.warn(`Recommender API returned status ${response.status}`);
                        // Optionally, you could try to read response.text() here for debugging,
                        // but it might delay navigation slightly.
                    }
                })
                .catch(error => {
                    // This catches errors in *sending* the request (e.g., network down, CORS issues)
                    console.error('Error sending request to recommender API:', error);
                    // Still navigate even if the fetch initiation fails, as per requirement
                })
                .finally(() => {
                     // --- Navigate to match.html REGARDLESS of API call success/failure ---
                     // Use a tiny timeout to ensure the fetch request has been dispatched
                     // by the browser before the page unloads.
                     setTimeout(() => {
                        console.log("Navigating to match.html");
                        window.location.href = 'match.html';
                     }, 100); // 100ms delay is usually sufficient
                });
    
                // IMPORTANT: Navigation happens inside the .finally() block after a short delay.
            }
    
    
            function handleLikeClick(likeButton) {
                likeButton.classList.toggle('liked');
                const icon = likeButton.querySelector('i');
                const isLiked = likeButton.classList.contains('liked');
                icon.className = isLiked ? 'fas fa-thumbs-up' : 'far fa-thumbs-up';
                likeButton.innerHTML = `<i class="${icon.className}"></i> ${isLiked ? 'Liked' : 'Like'}`;
            }
    
            function handleCommentToggle(commentTrigger) {
                const card = commentTrigger.closest('.message-card');
                const commentSection = card?.querySelector('.comment-section');
                if (commentSection) {
                    commentSection.classList.toggle('active');
                    if (commentSection.classList.contains('active')) {
                        commentSection.querySelector('.comment-input').focus();
                    }
                }
            }
    
            function handlePostComment(postButton) {
                 const commentSection = postButton.closest('.comment-section');
                 const commentInput = commentSection?.querySelector('.comment-input');
                 const commentsDisplay = commentSection?.querySelector('.comments-display-area');
                 const commentText = commentInput?.value.trim();
    
                 if (commentText && commentsDisplay && commentInput) {
                     const newComment = document.createElement('div');
                     newComment.classList.add('comment-item');
                     const commenterName = "You";
                     const sanitizedComment = commentText
                                              .replace(/</g, "<")
                                              .replace(/>/g, ">")
                                              .replace(/\n/g, '<br>');
                     newComment.innerHTML = `<strong>${commenterName}:</strong> ${sanitizedComment}`;
                     commentsDisplay.appendChild(newComment);
                     commentsDisplay.scrollTop = commentsDisplay.scrollHeight;
                     commentInput.value = '';
                     commentInput.style.height = 'auto';
                 } else if (!commentText && commentInput) {
                     commentInput.focus();
                 }
            }
    
            function handleTutorMenuToggle(menuTrigger, event) {
                event.stopPropagation();
                const card = menuTrigger.closest('.message-card');
                const dropdown = card?.querySelector('.tutor-list-dropdown');
                if (dropdown) {
                    const isActive = dropdown.classList.contains('active');
                    document.querySelectorAll('.tutor-list-dropdown.active').forEach(dd => {
                        if (dd !== dropdown) dd.classList.remove('active');
                    });
                    dropdown.classList.toggle('active');
                }
            }
    
            // --- Event Listeners ---
    
            messageListContainer.addEventListener('click', function(event) {
                const target = event.target;
                const likeBtn = target.closest('.like-btn');
                const commentTriggerBtn = target.closest('.comment-trigger-btn');
                const postCommentBtn = target.closest('.post-comment-btn');
                const tutorMenuBtn = target.closest('.tutor-menu-trigger');
    
                if (likeBtn) handleLikeClick(likeBtn);
                else if (commentTriggerBtn) handleCommentToggle(commentTriggerBtn);
                else if (postCommentBtn) handlePostComment(postCommentBtn);
                else if (tutorMenuBtn) handleTutorMenuToggle(tutorMenuBtn, event);
            });
    
            messageListContainer.addEventListener('keypress', function(event) {
                if (event.key === 'Enter' && !event.shiftKey && event.target.classList.contains('comment-input')) {
                    event.preventDefault();
                    const postButton = event.target.closest('.comment-input-area')?.querySelector('.post-comment-btn');
                    if (postButton) handlePostComment(postButton);
                }
            });
    
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.tutor-menu-trigger') && !event.target.closest('.tutor-list-dropdown')) {
                    document.querySelectorAll('.tutor-list-dropdown.active').forEach(dd => dd.classList.remove('active'));
                }
            });
    
            searchBtn.addEventListener('click', () => {
                const searchTerm = searchBar.value.trim().toLowerCase();
                if (!searchTerm) {
                    initializePosts(); displayPage(1); return;
                }
                const filteredPosts = defaultPosts.filter(post =>
                    post.user.toLowerCase().includes(searchTerm) ||
                    post.content.toLowerCase().includes(searchTerm)
                );
                allPostsData = [...filteredPosts].reverse();
                displayPage(1);
                if (allPostsData.length === 0) {
                     messageListContainer.innerHTML = '<p style="text-align: center; color: var(--light-text); padding: 2rem;">No posts found matching your search.</p>';
                     paginationControls.innerHTML = '';
                 }
            });
            searchBar.addEventListener('keypress', (e) => { if (e.key === 'Enter') searchBtn.click(); });
            searchBar.addEventListener('input', () => { if (searchBar.value.trim() === '') { initializePosts(); displayPage(1); } });
    
            postBtn.addEventListener('click', () => {
                postModal.style.display = 'flex';
                setTimeout(() => modalContent.classList.add('active'), 10);
            });
            closeModalBtn.addEventListener('click', () => {
                modalContent.classList.remove('active');
                setTimeout(() => {
                    postModal.style.display = 'none';
                    postSuccessMsg.classList.remove('show');
                    // Reset button states in case modal closed manually after clicking match/post
                    submitPostBtn.classList.remove('posting');
                    submitPostBtn.textContent = 'Post';
                    submitPostBtn.disabled = false;
                    if(matchButton) {
                        matchButton.classList.remove('posting');
                        matchButton.textContent = 'Match'; // Reset text
                        matchButton.style.pointerEvents = 'auto';
                    }
                }, 300);
            });
            window.addEventListener('click', (event) => { if (event.target === postModal) closeModalBtn.click(); });
    
            submitPostBtn.addEventListener('click', handlePostSubmit);
    
            // --- ADDED: Event Listener for the Match Button ---
            if (matchButton) {
                matchButton.addEventListener('click', handleMatchClick);
            } else {
                console.error("Match button not found!"); // Debugging
            }
            // ----------------------------------------------------
    
            chatBtn.addEventListener('click', () => chatInterface.style.display = 'flex');
            closeChatBtn.addEventListener('click', () => chatInterface.style.display = 'none');
    
            function sendUserMessageChat() {
                const text = messageInputChat.value.trim();
                if (!text) return;
                const userMsgDiv = document.createElement('div');
                userMsgDiv.className = 'message user-message';
                userMsgDiv.innerHTML = `<div class="message-content"><p>${text.replace(/</g, "<").replace(/>/g, ">")}</p></div><div class="message-avatar">👤</div>`;
                chatMessages.appendChild(userMsgDiv);
                messageInputChat.value = '';
                setTimeout(() => {
                    const botMsgDiv = document.createElement('div');
                    botMsgDiv.className = 'message bot-message';
                    botMsgDiv.innerHTML = `<div class="message-avatar">🤖</div><div class="message-content"><p>Thanks for your message! A real agent will respond shortly.</p></div>`;
                    chatMessages.appendChild(botMsgDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            sendMessageChat.addEventListener('click', sendUserMessageChat);
            messageInputChat.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendUserMessageChat(); });
    
            // --- Initial Page Load ---
            initializePosts();
            displayPage(1);
    
        }); // End DOMContentLoaded
    </script>
</body>
</html>